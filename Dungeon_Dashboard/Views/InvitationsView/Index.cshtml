@{
    ViewData["Title"] = "My Invites";
}

<h2>Moje Zaproszenia</h2>

<div id="invitations-container" style="background-color: #2f2b3a; color: #ba9ffb; padding: 10px; border-radius: 5px;">
</div>

@section Scripts {
    <script>
        // Funkcja pomocnicza - dodaje zaproszenie do #invitations-container
        function addInvitationToList(inv) {
            const container = document.getElementById('invitations-container');

            // Jeśli jest tekst "Brak zaproszeń.", usuń go
            if (container.textContent === "Brak zaproszeń.") {
                container.innerHTML = "";
            }

            const div = document.createElement('div');
            div.style.marginBottom = "10px";
            div.textContent = `ID: ${inv.id}, Room: ${inv.roomId}, Inviter: ${inv.inviter}`;
            container.appendChild(div);
        }

        document.addEventListener('DOMContentLoaded', function () {
            // 1. Na starcie pobierz istniejące zaproszenia
            fetch('/api/invitations')
                .then(response => {
                    if (!response.ok) {
                        throw new Error("Błąd pobierania zaproszeń");
                    }
                    return response.json();
                })
                .then(invitations => {
                    console.log("Zaproszenia:", invitations);

                    const container = document.getElementById('invitations-container');
                    container.innerHTML = "";

                    if (!Array.isArray(invitations) || invitations.length === 0) {
                        container.textContent = "Brak zaproszeń.";
                        return;
                    }

                    // Dodaj zaproszenia do listy
                    invitations.forEach(inv => {
                        addInvitationToList(inv);
                    });
                })
                .catch(err => {
                    console.error(err);
                    alert("Błąd przy wczytywaniu zaproszeń: " + err.message);
                });

            
        });
    </script>
}
